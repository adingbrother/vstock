 ä¸ªäººé‡åŒ–æŠ•ç ” Web å¹³å°  
 å¤§æ¨¡å‹å¯ç›´æ¥å¼€å‘ç‰ˆéœ€æ±‚è§„æ ¼ + è¯¦ç»†è®¾è®¡æ–‡æ¡£  
ç‰ˆæœ¬ï¼šv5.0-Finalï¼ˆå†²çªå·²åˆå¹¶ï¼Œå¼€å‘çº§ç»†åŒ–ï¼‰  
æ›´æ–°ï¼š2024-01-26  
ç›®çš„ï¼šç»™å¤§æ¨¡å‹ç ”å‘äººå‘˜ä¸€æ¬¡æ€§ç”Ÿæˆå…¨éƒ¨ä»£ç ï¼Œé›¶æ­§ä¹‰ï¼Œé›¶äººå·¥è¡¥å……  
 1. æ–‡æ¡£ä½¿ç”¨è¯´æ˜ï¼ˆç»™å¤§æ¨¡å‹çš„ Promptï¼‰
ä½ æ˜¯ä¸€åã€Œå…¨æ ˆé‡åŒ–å¹³å°æ¶æ„å¸ˆã€ï¼Œè¯·ä¾æ®ä»¥ä¸‹ç»“æ„åŒ–éœ€æ±‚+è®¾è®¡+åŸå‹+æµ‹è¯•+è¿ç»´å†…å®¹ï¼Œä¸€æ¬¡æ€§ç”Ÿæˆå¯ç›´æ¥è¿è¡Œçš„ Python/FastAPI + Vue3 + SQL + Dockerå®Œæ•´å·¥ç¨‹ã€‚  
ç¦æ­¢é—æ¼ï¼šå‡½æ•°åŸå‹ã€å­—æ®µçº¦æŸã€åˆ†æ”¯å¼‚å¸¸ã€æµ‹è¯•ç”¨ä¾‹ã€è¿ç»´è„šæœ¬ã€ä¸Šçº¿æ£€æŸ¥å•ã€‚  
ç¦æ­¢æ­§ä¹‰ï¼šæ‰€æœ‰å¸¸é‡ã€é­”æ³•å€¼ã€è·¯å¾„ã€å‘½åã€ç´¢å¼•ã€é”™è¯¯ç å‡å·²æ˜ç¡®ã€‚  
 2. é¡¹ç›®å…ƒä¿¡æ¯ï¼ˆä¸å˜ï¼‰
| å­—æ®µ | å€¼ |
|||
| äº§å“å | ä¸ªäººé‡åŒ–æŠ•ç ” Web å¹³å° |
| ç‰ˆæœ¬ | v5.0-Final |
| äº¤ä»˜ | æœ¬åœ° Web æœåŠ¡å™¨ + æµè§ˆå™¨ |
| ç›®æ ‡ | ä¸ªäººé‡åŒ–çˆ±å¥½è€…ã€é«˜æ ¡ã€å°ç§å‹Ÿ |
| è¾¹ç•Œ | ä»…æŠ•ç ”ï¼Œæ— å®ç›˜ï¼›å•ç”¨æˆ·ï¼›æœ¬åœ°éƒ¨ç½²ï¼›4C8G æµç•… |
 3. æ€»ä½“æ¶æ„ï¼ˆå†²çªå·²åˆå¹¶ï¼‰
æµè§ˆå™¨å±‚ï¼šVue3 + TS + Element-Plus + ECharts5 + Monaco
ç½‘å…³å±‚ï¼šFastAPI 0.110 + uvicorn 4 workers + CORSå…¨å¼€
ä¸šåŠ¡å±‚ï¼šå¼‚æ­¥Service + Celery 5.3 + Redis 7
æ•°æ®å±‚ï¼šSQLAlchemy 2.0 + SQLiteé»˜è®¤+MySQLå¯é€‰+åˆ†åŒºè¡¨
å­˜å‚¨å±‚ï¼šæœ¬åœ°æ–‡ä»¶ + HDF5 + ./data/ + ./backup/ + S3é¢„ç•™
 4. ä¸šåŠ¡æ³³é“ï¼ˆä¸å˜ï¼‰
è§ mermaid åºåˆ—å›¾ï¼ˆç¬¬2ç« ï¼‰  
 5. åŠŸèƒ½æ¨¡å—æ ‘ï¼ˆå†²çªå·²åˆå¹¶ï¼‰
â”œâ”€ DM æ•°æ®ç®¡ç†
â”‚  â”œâ”€ DM-01 å¤šæºæ¥å…¥ï¼ˆAkShare/Tushareé€‚é…å™¨ï¼‰
â”‚  â”œâ”€ DM-02 æ•°æ®æ¸…æ´—ï¼ˆç¼ºå¤±ã€å¼‚å¸¸ã€å¤æƒï¼‰
â”‚  â”œâ”€ DM-03 å­˜å‚¨ä¸ç‰ˆæœ¬ï¼ˆSQLite+åˆ†åŒº+å¤‡ä»½ï¼‰
â”‚  â””â”€ DM-04 æŸ¥è¯¢APIï¼ˆREST+Redisç¼“å­˜ï¼‰
â”œâ”€ SM ç­–ç•¥ç®¡ç†
â”‚  â”œâ”€ SM-01 Monacoç¼–è¾‘å™¨ï¼ˆè¡¥å…¨ã€è¯­æ³•ã€ä¸»é¢˜ï¼‰
â”‚  â”œâ”€ SM-02 æ¨¡æ¿å¸‚åœºï¼ˆ12ç­–ç•¥ï¼‰
â”‚  â”œâ”€ SM-03 å‚æ•°å¯è§†åŒ–ï¼ˆg_paramsè¡¨å•ï¼‰
â”‚  â””â”€ SM-04 å¯¼å…¥å¯¼å‡ºï¼ˆ.py/.zip+åŠ å¯†å¯é€‰ï¼‰
â”œâ”€ BE å›æµ‹å¼•æ“
â”‚  â”œâ”€ BE-01 ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸï¼ˆPendingâ†’Successï¼‰
â”‚  â”œâ”€ BE-02 æ’®åˆå­å¼•æ“ï¼ˆé™ä»·/å¸‚ä»·/æ»‘ç‚¹/æ‰‹ç»­è´¹ï¼‰
â”‚  â”œâ”€ BE-03 ç»©æ•ˆæŒ‡æ ‡ï¼ˆæ”¶ç›Šã€é£é™©ã€äº¤æ˜“ç»Ÿè®¡ï¼‰
â”‚  â””â”€ BE-04 å¼‚å¸¸ç†”æ–­ï¼ˆè¶…æ—¶ã€å†…å­˜ã€ä»£ç å¼‚å¸¸ï¼‰
â”œâ”€ RE æ¨èå¼•æ“
â”‚  â”œâ”€ RE-01 æ¨èç­–ç•¥ç®¡ç†ï¼ˆå•ç­–ç•¥vsèåˆæƒé‡ï¼‰
â”‚  â”œâ”€ RE-02 å¤šå› å­è¯„åˆ†ï¼ˆæ”¶ç›Š40%ç¨³å®š30%æ´»è·ƒ20%è´¨é‡10%ï¼‰
â”‚  â”œâ”€ RE-03 Top-Nåˆ—è¡¨ï¼ˆå¼ºçƒˆ/å…³æ³¨/è°¨æ…ä¸‰æ¡£ï¼‰
â”‚  â””â”€ RE-04 æ•ˆæœè¿½è¸ªï¼ˆ5/10/20æ—¥èƒœç‡ã€ç”¨æˆ·åé¦ˆï¼‰
â”œâ”€ VIS å¯è§†åŒ–
â”‚  â”œâ”€ VIS-01 Kçº¿+æŒ‡æ ‡+ä¿¡å·ï¼ˆEChartsäº¤äº’ï¼‰
â”‚  â”œâ”€ VIS-02 èµ„é‡‘æ›²çº¿ï¼ˆæƒç›Š+å›æ’¤+åŸºå‡†ï¼‰
â”‚  â”œâ”€ VIS-03 æ¨èé›·è¾¾å›¾ï¼ˆäº”ç»´å› å­ï¼‰
â”‚  â””â”€ VIS-04 çƒ­åŠ›å›¾ï¼ˆè‚¡ç¥¨Ã—ç­–ç•¥è¯„åˆ†çŸ©é˜µï¼‰
â””â”€ SYS ç³»ç»Ÿç®¡ç†
   â”œâ”€ SYS-01 ç³»ç»Ÿé…ç½®ï¼ˆæ•°æ®æºã€ç¼“å­˜ã€æ€§èƒ½é˜ˆå€¼ï¼‰
   â”œâ”€ SYS-02 å¥åº·ç›‘æ§ï¼ˆCPU/å†…å­˜/ç£ç›˜/é˜Ÿåˆ—ï¼‰
   â””â”€ SYS-03 æ—¥å¿—ä¸å‘Šè­¦ï¼ˆåˆ†çº§ã€è½®è½¬ã€é‚®ä»¶å¯é€‰ï¼‰
 6. è¯¦ç»†è®¾è®¡ï¼ˆå‡½æ•°çº§åŸå‹ + åˆ†æ”¯ + å¼‚å¸¸ + å¸¸é‡ï¼‰
 6.1 å¸¸é‡ä¸é­”æ³•å€¼ï¼ˆå…¨å±€ç¦æ­¢ç¡¬ç¼–ç ï¼‰
python
 quant_web/core/const.py
AK_SLEEP = 0.5           AkShare è¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰
MAX_RETRY = 3            ä¸‹è½½é‡è¯•æ¬¡æ•°
SLIP_RANGE = (-0.01, 0.01)   æ»‘ç‚¹éšæœºèŒƒå›´ï¼ˆå…ƒï¼‰
MAX_DD_THRESHOLD = 0.2   æœ€å¤§å›æ’¤å‘Šè­¦é˜ˆå€¼ï¼ˆ20%ï¼‰
WORKER_MAX_MEM = 2_000_000_000   2GB å†…å­˜ç†”æ–­ï¼ˆå­—èŠ‚ï¼‰
BATCH_SIZE = 1000        æ•°æ®åº“ bulk_insert æ‰¹å¤§å°
QUALITY_SCORE_MIN = 60   æ•°æ®è´¨é‡æœ€ä½åˆ†
FACTOR_WEIGHTS = {
    "return": 0.4,
    "stability": 0.3,
    "active": 0.2,
    "quality": 0.1
}
 6.2 å‡½æ•°çº§åŸå‹ï¼ˆä¼ªä»£ç â†’å¯ç›´æ¥å®ç°ï¼‰
 DM-01-01 ä¸‹è½½å‡½æ•°ï¼ˆå«åˆ†æ”¯+å¼‚å¸¸ï¼‰
python
 quant_web/core/dm/akshare_adapter.py
import akshare as ak
import pandas as pd
import asyncio
from loguru import logger
from const import AK_SLEEP, MAX_RETRY, BATCH_SIZE
class AkShareAdapter:
    async def download_daily(self, ts_code: str, start: str, end: str) -> pd.DataFrame:
        """ä¸‹è½½æ—¥çº¿ï¼›è¿”å›æ ‡å‡† DF [trade_date, open, high, low, close, vol, amount]"""
        for attempt in range(1, MAX_RETRY + 1):
            try:
                code = self._to_ak_code(ts_code)
                df = await asyncio.to_thread(ak.stock_zh_a_hist, symbol=code, period="daily", start_date=start, end_date=end)
                if df is None or df.empty:
                    raise ValueError(f"AkShare è¿”å›ç©ºæ•°æ® {ts_code} å°è¯•={attempt}")
                df = df.rename(columns={
                    "æ—¥æœŸ": "trade_date", "å¼€ç›˜": "open", "æ”¶ç›˜": "close", "æœ€é«˜": "high", "æœ€ä½": "low", "æˆäº¤é‡": "vol", "æˆäº¤é¢": "amount"
                })
                df["trade_date"] = pd.to_datetime(df["trade_date"]).dt.strftime("%Y%m%d")
                df["source"] = "akshare"
                await asyncio.sleep(AK_SLEEP)
                logger.info(f"AkShare ä¸‹è½½å®Œæˆ {ts_code} {len(df)} æ¡")
                return df
            except Exception as e:
                logger.warning(f"AkShare ä¸‹è½½å¤±è´¥ {ts_code} å°è¯•={attempt} {e}")
                if attempt == MAX_RETRY:
                    raise e
                await asyncio.sleep(attempt  2)   æŒ‡æ•°é€€é¿
 BE-02-01 æ’®åˆå‡½æ•°ï¼ˆåˆ†æ”¯+æ»‘ç‚¹å¸¸é‡ï¼‰
python
 quant_web/core/be/matcher.py
import random
from const import SLIP_RANGE
from models.trade import Order, Trade, Bar
class SimpleMatcher:
    def match(self, order: Order, bar: Bar) -> Optional[Trade]:
        """è¿”å› Trade æˆ– Noneï¼›å¸¸é‡æ»‘ç‚¹"""
        if order.order_type == "market":
            price = bar.close + random.uniform(SLIP_RANGE)
            return Trade(ts_code=order.ts_code, price=round(price, 2), qty=order.qty, side=order.side)
        if order.order_type == "limit":
            if (order.side == "buy" and bar.low <= order.price) or (order.side == "sell" and bar.high >= order.price):
                return Trade(ts_code=order.ts_code, price=order.price, qty=order.qty, side=order.side)
        return None
 RE-02-01 å¤šå› å­è¯„åˆ†ï¼ˆæƒé‡å¸¸é‡+å…¬å¼ï¼‰
python
 quant_web/core/re/factor_model.py
from const import FACTOR_WEIGHTS
class FactorModel:
    def score(self, stock: str, results: list[StrategyResult]) -> float:
        """è¿”å› 0-100 ç»¼åˆåˆ†ï¼›æƒé‡è§å¸¸é‡"""
        raw = {f: self._calc(f, stock, results) for f in FACTOR_WEIGHTS}
        z_score = {k: (v - self.stats[k]['mean']) / self.stats[k]['std'] for k, v in raw.items()}
        weighted = sum(z_score[f]  FACTOR_WEIGHTS[f] for f in FACTOR_WEIGHTS)
        return 50 + 10  weighted   æ˜ å°„åˆ° 0-100
 7. æ•°æ®åº“è®¾è®¡ï¼ˆå­—æ®µçº§+çº¦æŸ+ç´¢å¼•+åˆ†åŒºDDLï¼‰
 7.1 è‚¡ç¥¨åˆ—è¡¨
sql
-- SQLite
CREATE TABLE stock_basic (
    ts_code TEXT PRIMARY KEY,          -- 000001.SZ
    symbol TEXT NOT NULL,              -- 000001
    name TEXT NOT NULL,                -- å¹³å®‰é“¶è¡Œ
    area TEXT,                         -- æ·±åœ³
    industry TEXT,                     -- é“¶è¡Œ
    list_date TEXT,                    -- 19910403
    data_source TEXT DEFAULT 'akshare' CHECK(data_source IN ('akshare','tushare')),
    status INTEGER DEFAULT 1 CHECK(status IN (0,1)),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_sb_industry ON stock_basic(industry);
 7.2 K çº¿åˆ†åŒºè¡¨ï¼ˆMySQL è¯­æ³•ï¼‰
sql
CREATE TABLE kline_000001_sz (
    trade_date DATE NOT NULL,
    open DECIMAL(10,2) NOT NULL CHECK(open >= 0),
    high DECIMAL(10,2) NOT NULL CHECK(high >= 0),
    low DECIMAL(10,2) NOT NULL CHECK(low >= 0),
    close DECIMAL(10,2) NOT NULL CHECK(close >= 0),
    vol BIGINT NOT NULL CHECK(vol >= 0),
    amount DECIMAL(20,2) NOT NULL CHECK(amount >= 0),
    source TEXT CHECK(source IN ('akshare','tushare')),
    PRIMARY KEY (trade_date)
) PARTITION BY RANGE (YEAR(trade_date)) (
    PARTITION p2020 VALUES LESS THAN (2021),
    PARTITION p2021 VALUES LESS THAN (2022),
    PARTITION p2022 VALUES LESS THAN (2023),
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025)
);
 8. æ¥å£è§„èŒƒï¼ˆå­—æ®µçº§+ç¤ºä¾‹+é”™è¯¯ç ï¼‰
 8.1 ä¸‹è½½æäº¤
POST /api/v1/data/download
Request:
{
  "stock_list": ["000001.SZ", "600000.SH"],
  "start_date": "20230101",
  "end_date": "20231231",
  "source": "akshare"
}
Response 202:
{
  "task_id": "DL_1700000001",
  "status": "Pending",
  "estimated_seconds": 120
}
WebSocket push:
{"type": "progress", "task_id": "DL_1700000001", "percent": 45, "message": "000001.SZ å·²ä¸‹è½½"}
Error 400:
{"code": 40001, "message": "start_date æ ¼å¼é”™è¯¯"}
 8.2 å›æµ‹æäº¤
POST /api/v1/backtest/submit
Request:
{
  "strategy_id": "st_0001",
  "stock_pool": ["000001.SZ"],
  "start_date": "20230101",
  "end_date": "20231231",
  "init_cash": 100000,
  "params": {"fast": 5, "slow": 20}
}
Response 202:
{"task_id": "BK_1700000002", "status": "Pending"}
 9. å®‰å…¨è®¾è®¡ï¼ˆOWASP Top10 å¯¹ç…§+å®ç°ï¼‰
| é£é™© | å…·ä½“å®ç° |
|||
| A01 è®¿é—®æ§åˆ¶ | å•ç”¨æˆ·é»˜è®¤ local_userï¼›JWT å¯é€‰ï¼›æ–‡ä»¶æƒé™ 600 |
| A02 åŠ å¯†å¤±è´¥ | Token å­—æ®µ AES-256-CBC åŠ å¯†ï¼›HTTPS é¢„ç•™ |
| A03 æ³¨å…¥ | SQLAlchemy ORMï¼›æ‰€æœ‰å‚æ•°åŒ–æŸ¥è¯¢ï¼›ç”¨æˆ·ç­–ç•¥æ²™ç®±ï¼ˆç¦æ­¢ import os/sysï¼‰ |
| A04 ä¸å®‰å…¨è®¾è®¡ | ç­–ç•¥è¶…æ—¶ 30min å¼ºåˆ¶ killï¼›å†…å­˜ä¸Šé™ 2GBï¼›æ»‘ç‚¹/æ‰‹ç»­è´¹å¸¸é‡ä¸å¯ä¿®æ”¹ |
| A05 å®‰å…¨é…ç½® | ç”Ÿäº§ç¯å¢ƒå…³é—­ /docsï¼›CORS ç™½åå•ï¼›Redis æ— å¯†ç æœ¬åœ° |
| A06 ç»„ä»¶æ¼æ´ | pip-audit CI é˜¶æ®µï¼›requirements é”å®šï¼›bandit æ‰«æ |
| A09 æ—¥å¿—è®°å½• | ç»Ÿä¸€ log IDï¼›é”™è¯¯å †æ ˆä¸è¿”å‰ç«¯ï¼›æ—¥å¿—çº§åˆ« INFO |
| A10 SSRF | ä¸‹è½½åŸŸåç™½åå•ï¼›ç­–ç•¥å†…ç¦æ­¢ http è¯·æ±‚ï¼›é™åˆ¶ import |
 10. æ€§èƒ½ä¸æ‰©å±•æ€§ï¼ˆæ•°å€¼+é¢„ç•™ï¼‰
| åœºæ™¯ | å½“å‰ç›®æ ‡ | 10Ã— é¢„ç•™æ–¹æ¡ˆ |
| è‚¡ç¥¨æ•° | 1 ä¸‡ | MySQL åˆ†åŒº+è¯»å†™åˆ†ç¦» |
| K çº¿é‡ | 1 äº¿æ¡ | æŒ‰å¹´åˆ†åŒº+HDF5+S3 |
| å¹¶å‘å›æµ‹ | 3 ä»»åŠ¡ | Celery Worker æ¨ªå‘ 30 |
| å‰ç«¯æ¸²æŸ“ | 5k K çº¿ç‚¹ | ECharts é‡‡æ · 50k |
æ€§èƒ½é—¨ç¦ï¼š
- å•è‚¡ç¥¨å›æµ‹ 1 å¹´æ—¥çº¿ â‰¤ 8sï¼ˆ4C8Gï¼‰
- ä¸‹è½½ 100 åªè‚¡ç¥¨æ—¥çº¿ â‰¤ 120s
- WebSocket æ¨é€å»¶è¿Ÿ â‰¤ 500ms
 11. å¼€å‘æ’æœŸï¼ˆäººæ—¶çº§ç”˜ç‰¹å›¾ï¼‰
 11.1 äººåŠ›æ± 
- åç«¯ï¼š3 äººï¼ˆA/B/Cï¼‰
- å‰ç«¯ï¼š2 äººï¼ˆD/Eï¼‰
- æµ‹è¯•ï¼š1 äººï¼ˆFï¼‰
- æ€»è®¡ï¼š6 äºº Ã— 8h Ã— 5d Ã— 8 å‘¨ = 1920 äººæ—¶
 11.2 å…³é”®è·¯å¾„ï¼ˆäººæ—¶ï¼‰
| ä»»åŠ¡ | äººæ—¶ | ä¾èµ– | å¼€å§‹ | ç»“æŸ |
||
| AkShare é€‚é…å™¨ | 32h | â€” | D1 | D2 |
| DAO+åˆ†åŒºè¡¨ | 24h | AkShare | D2 | D3 |
| æ’®åˆå¼•æ“ | 48h | DAO | D5 | D7 |
| æŠ¥å‘Šç”Ÿæˆ | 32h | æ’®åˆ | D9 | D10 |
| ECharts K çº¿ | 40h | æŠ¥å‘Š | D13 | D15 |
| é›†æˆæµ‹è¯• | 80h | K çº¿ | D15 | D20 |
â–£ å…³é”®è·¯å¾„å·¥æ—¶ï¼š32+24+48+32+40+80 = 256hï¼ˆ4.3 äººå‘¨ï¼‰
 11.3 ç”˜ç‰¹å›¾ï¼ˆå‘¨ï¼‰
å‘¨1ï¼šDM-01 å®Œæˆï¼ˆAkShare+DAOï¼‰
å‘¨2ï¼šDM-02 å®Œæˆï¼ˆæ¸…æ´—+è´¨é‡ï¼‰
å‘¨3ï¼šSM-01 å®Œæˆï¼ˆMonaco+æ¨¡æ¿ï¼‰
å‘¨4ï¼šBE-01 å®Œæˆï¼ˆæ’®åˆ+æŒ‡æ ‡ï¼‰
å‘¨5ï¼šBE-02 å®Œæˆï¼ˆæŠ¥å‘Š+æ—¥å¿—ï¼‰
å‘¨6ï¼šRE-01 å®Œæˆï¼ˆå› å­+è¯„åˆ†ï¼‰
å‘¨7ï¼šVIS-01 å®Œæˆï¼ˆK çº¿+èµ„é‡‘æ›²çº¿ï¼‰
å‘¨8ï¼šæµ‹è¯•+æ–‡æ¡£+ä¸Šçº¿
 12. æµ‹è¯•ç­–ç•¥ï¼ˆé—¨ç¦â†’ç”¨ä¾‹â†’è‡ªåŠ¨åŒ–ï¼‰
 12.1 è´¨é‡é—¨ç¦
- å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%ï¼ˆpytest-covï¼‰
- æ ¸å¿ƒæ¥å£ P95 å»¶è¿Ÿ â‰¤ 500msï¼ˆlocustï¼‰
- å¹¶å‘ 3 å›æµ‹ä»»åŠ¡æ— å´©æºƒï¼ˆstressï¼‰
- å†…å­˜å³°å€¼ â‰¤ 2GB/ä»»åŠ¡ï¼ˆmemory_profilerï¼‰
 12.2 æµ‹è¯•é‡‘å­—å¡”
| å±‚çº§ | å æ¯” | å·¥å…· | æŒ‡æ ‡ |
|
| å•å…ƒ | 80% | pytest+cov | â‰¥ 80% è¡Œè¦†ç›– |
| é›†æˆ | 15% | pytest-asyncio | æ ¸å¿ƒæµç¨‹æ— æŠ¥é”™ |
| E2E | 5% | Cypress | ä¸»æµç¨‹ < 2min |
 12.3 æ ¸å¿ƒç”¨ä¾‹ï¼ˆå°æ—¶çº§ï¼‰
| ID | æè¿° | è¾“å…¥ | é¢„æœŸ | å·¥æ—¶ |
||
| UT-DM-01 | ä¸‹è½½ 000001.SZ 2023 | ts_code, start, end | DataFrame â‰¥ 240 è¡Œï¼›æ—  NaN | 2h |
| IT-BE-01 | åŒå‡çº¿å›æµ‹ | 000001.SZ, 2023 | æ”¶ç›Šç‡ä¸èšå®½è¯¯å·® < 0.1% | 4h |
| PT-PERF-01 | 10 ç”¨æˆ·å¹¶å‘å›æµ‹ | locust 10 å¹¶å‘ | P95 â‰¤ 500msï¼›é”™è¯¯ç‡ 0% | 4h |
 12.4 è‡ªåŠ¨åŒ– CI/CD
yaml
 .github/workflows/ci.yml
name: ci
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with: {python-version: '3.11'}
      - run: pip install pip-audit pytest pytest-cov locust
      - run: pip-audit
      - run: pytest --cov=80 --cov-report=xml
      - run: locust -f tests/perf/locustfile.py --headless -u 10 -r 2 -t 30s --csv=perf
      - run: docker build -t quant-web .
 13. äº¤ä»˜ä¸ä¸Šçº¿ Checklistï¼ˆå¯å‹¾é€‰ï¼‰
 13.1 ä»£ç äº¤ä»˜
- [ ] main.py ä¸€é”®å¯åŠ¨éªŒè¯ï¼ˆWin/Mac/Linuxï¼‰
- [ ] requirements.txt ç‰ˆæœ¬é”å®š + pip-audit é€šè¿‡
- [ ] Dockerfile + docker-compose.yml æ„å»ºæˆåŠŸ
- [ ] alembic upgrade head æ— æŠ¥é”™
 13.2 æ–‡æ¡£äº¤ä»˜
- [ ] API æ–‡æ¡£ï¼ˆSwagger è‡ªåŠ¨å¯¼å‡º PDFï¼‰
- [ ] ç”¨æˆ·æ‰‹å†Œï¼ˆMarkdownâ†’HTMLï¼‰
- [ ] éƒ¨ç½²æ‰‹å†Œï¼ˆå«è„šæœ¬ã€ç›‘æ§ã€å¤‡ä»½ï¼‰
 13.3 æµ‹è¯•äº¤ä»˜
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- [ ] å¹¶å‘å‹æµ‹æŠ¥å‘Šï¼ˆlocust å¯¼å‡ºï¼‰
- [ ] ç§å­ç”¨æˆ·éªŒæ”¶é€šè¿‡ï¼ˆ5 äººï¼‰
 13.4 è¿ç»´äº¤ä»˜
- [ ] è‡ªåŠ¨å¤‡ä»½è„šæœ¬éªŒè¯
- [ ] å¥åº·æ£€æŸ¥æ¥å£ /api/health 200
- [ ] æ—¥å¿—è½®è½¬ + å‘Šè­¦é‚®ä»¶æµ‹è¯•
 13.5 ç‰ˆæœ¬äº¤ä»˜
- [ ] Git Tag v1.0 æ‰“ç‰ˆ
- [ ] Release Notes å‘å¸ƒ
 14. ä¸€é”®ç”Ÿæˆè„šæœ¬ï¼ˆç»™å¤§æ¨¡å‹ç›´æ¥è¾“å‡ºï¼‰
 14.1 ç”Ÿæˆç›®å½•ç»“æ„
bash
mkdir -p quant_web/{api/v1,core/{dm,sm,be,re,vis,sys},models,tests/{unit,integration,perf},scripts,docs,data,backup}
 14.2 ç”Ÿæˆå¸¸é‡æ–‡ä»¶
python
 quant_web/core/const.py
AK_SLEEP = 0.5
MAX_RETRY = 3
SLIP_RANGE = (-0.01, 0.01)
MAX_DD_THRESHOLD = 0.2
WORKER_MAX_MEM = 2_000_000_000
BATCH_SIZE = 1000
QUALITY_SCORE_MIN = 60
FACTOR_WEIGHTS = {"return": 0.4, "stability": 0.3, "active": 0.2, "quality": 0.1}
 14.3 ç”Ÿæˆ main.pyï¼ˆå®Œæ•´ï¼‰
python
 quant_web/main.py
from fastapi import FastAPI, WebSocket, WebSocketDisconnect
from api.v1 import data, strategy, backtest, recommend
from core.common.logger import setup_logger
from core.const import MAX_DD_THRESHOLD
import uvicorn
setup_logger()
app = FastAPI(title="QuantWeb", version="v1.0")
app.include_router(data.router, prefix="/api/v1")
app.include_router(strategy.router, prefix="/api/v1")
app.include_router(backtest.router, prefix="/api/v1")
app.include_router(recommend.router, prefix="/api/v1")
@app.websocket("/ws/{task_id}")
async def websocket_endpoint(websocket: WebSocket, task_id: str):
    await websocket.accept()
     Redis PubSub ç®€åŒ–ç‰ˆ
    while True:
        try:
            msg = await redis.pubsub.get_message(ignore_subscribe_messages=True)
            if msg:
                await websocket.send_json(json.loads(msg["data"]))
        except WebSocketDisconnect:
            break
if __name__ == "__main__":
    uvicorn.run("main:app", host="0.0.0.0", port=8000, workers=4)
 14.4 ç”Ÿæˆ Dockerfile
dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
EXPOSE 8000
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
 14.5 ç”Ÿæˆ requirements.txtï¼ˆé”å®šï¼‰
fastapi==0.110.0
uvicorn[standard]==0.27.0
sqlalchemy==2.0.23
alembic==1.13.1
redis==5.0.1
celery==5.3.4
pandas==2.1.4
numpy==1.26.2
akshare==1.11.1
tushare==1.3.0
loguru==0.7.2
pytest==7.4.3
pytest-cov==4.1.0
locust==2.20.1
 14.6 ç”Ÿæˆ run.batï¼ˆWindows ä¸€é”®å¯åŠ¨ï¼‰
bat
@echo off
echo [QuantWeb] Starting...
start http://localhost:8000
python -m uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
 14.7 ç”Ÿæˆ run.shï¼ˆLinux/Mac ä¸€é”®å¯åŠ¨ï¼‰
bash
!/bin/bash
echo "[QuantWeb] Starting..."
open http://localhost:8000
python3 -m uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
 14.8 ç”Ÿæˆ CI/CD æ–‡ä»¶
yaml
 .github/workflows/ci.yml
name: ci
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with: {python-version: '3.11'}
      - run: pip install -r requirements.txt
      - run: pip-audit
      - run: pytest --cov=80 --cov-report=xml
      - run: locust -f tests/perf/locustfile.py --headless -u 10 -r 2 -t 30s --csv=perf
      - run: docker build -t quant-web .
 15. æœ€ç»ˆäº¤ä»˜ç‰©æ¸…å•ï¼ˆç»™å¤§æ¨¡å‹ä¸€æ¬¡æ€§ç”Ÿæˆï¼‰
1. å®Œæ•´ç›®å½•ç»“æ„ï¼ˆ14.1ï¼‰
2. å…¨éƒ¨ Python æºç ï¼ˆmain.pyã€å„æ¨¡å—ã€å¸¸é‡ã€å‡½æ•°åŸå‹ã€åˆ†æ”¯ã€å¼‚å¸¸ï¼‰
3. å…¨éƒ¨ SQL DDLï¼ˆåˆ†åŒº+ç´¢å¼•+çº¦æŸï¼‰
4. å…¨éƒ¨æ¥å£è§„èŒƒï¼ˆURL+è¯·æ±‚+å“åº”+é”™è¯¯ç +ç¤ºä¾‹ï¼‰
5. å…¨éƒ¨å‰ç«¯ Vue3 ç»„ä»¶ï¼ˆMonaco+ECharts+WebSocketï¼‰
6. å…¨éƒ¨æµ‹è¯•ç”¨ä¾‹ï¼ˆpytest+locustï¼‰
7. å…¨éƒ¨è¿ç»´è„šæœ¬ï¼ˆrun.bat/shã€Dockerã€CI/CDã€å¤‡ä»½ï¼‰
8. å…¨éƒ¨æ–‡æ¡£ï¼ˆAPI Swaggerã€ç”¨æˆ·æ‰‹å†Œã€éƒ¨ç½²æ‰‹å†Œï¼‰
 16. æœ€ç»ˆ Prompt è¯­å¥ï¼ˆç»™å¤§æ¨¡å‹ï¼‰
è¯·ä¾æ®ä»¥ä¸Šå†…å®¹ï¼Œä¸€æ¬¡æ€§ç”Ÿæˆå®Œæ•´ã€å¯è¿è¡Œã€é›¶æ­§ä¹‰çš„ã€Œä¸ªäººé‡åŒ–æŠ•ç ” Web å¹³å°ã€å…¨éƒ¨æºä»£ç ã€SQLã€Dockerã€æ–‡æ¡£ã€æµ‹è¯•ã€è¿ç»´è„šæœ¬ï¼Œå¹¶ç¡®ä¿ï¼š
1. æ‰€æœ‰å‡½æ•°ã€å­—æ®µã€å¸¸é‡ã€è·¯å¾„ã€å‘½åã€é”™è¯¯ç ä¸æœ¬æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
2. æ‰€æœ‰åˆ†æ”¯ã€å¼‚å¸¸ã€é‡è¯•ã€æ»‘ç‚¹ã€æƒé‡ã€å…¬å¼ä¸æœ¬æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
3. æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ã€æ€§èƒ½é—¨ç¦ã€CI/CDã€ä¸Šçº¿æ¸…å•ä¸æœ¬æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
4. ç”Ÿæˆåå¯ç›´æ¥ `docker-compose up` è¿è¡Œï¼Œæµè§ˆå™¨è®¿é—® `http://localhost:8000` å³å¯ä½¿ç”¨å…¨éƒ¨åŠŸèƒ½ã€‚
ç¡®ä¿ï¼š
- æ‰€æœ‰å¸¸é‡ã€å­—æ®µã€è·¯å¾„ã€å‘½åã€é”™è¯¯ç ä¸æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
- æ‰€æœ‰åˆ†æ”¯ã€å¼‚å¸¸ã€é‡è¯•ã€æ»‘ç‚¹ã€æƒé‡ã€å…¬å¼ä¸æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
- æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ã€æ€§èƒ½é—¨ç¦ã€CI/CDã€ä¸Šçº¿æ¸…å•ä¸æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
- ç”Ÿæˆåæ— éœ€äººå·¥ä¿®æ”¹ä»»ä½•æ–‡ä»¶ã€‚
 ä¸ªäººé‡åŒ–æŠ•ç ” Web å¹³å°  
 å¤§æ¨¡å‹ç›´æ¥å¼€å‘ç‰ˆè¡¥å……æ–‡æ¡£ï¼ˆv6.0-Finalï¼‰
æ›´æ–°ï¼š2024-01-27  
ç›®çš„ï¼šè¡¥å……å‰ç«¯å®Œæ•´åŸå‹ã€SQLæ–‡ä»¶ã€è¿ç»´è„šæœ¬ã€æµ‹è¯•æ–‡ä»¶ã€CI/CDã€æ–‡æ¡£æ¨¡æ¿ï¼Œç¡®ä¿å¤§æ¨¡å‹é›¶æ­§ä¹‰ä¸€æ¬¡æ€§ç”Ÿæˆå®Œæ•´å·¥ç¨‹ã€‚
 ç›®å½•
1. å‰ç«¯å®Œæ•´åŸå‹ï¼ˆç»„ä»¶+é…ç½®+è·¯ç”±+Storeï¼‰  
2. SQL å®Œæ•´æ–‡ä»¶ï¼ˆinit+seed+åˆ†åŒº+ç´¢å¼•ï¼‰  
3. è¿ç»´å®Œæ•´è„šæœ¬ï¼ˆå¤‡ä»½+æ¢å¤+å¥åº·+å‡çº§ï¼‰  
4. æµ‹è¯•å®Œæ•´æ–‡ä»¶ï¼ˆpytest+locust+fixturesï¼‰  
5. Docker å®Œæ•´æ–‡ä»¶ï¼ˆcompose+env+Dockerfileï¼‰  
6. CI/CD å®Œæ•´æ–‡ä»¶ï¼ˆCI+CD+Releaseï¼‰  
7. æ–‡æ¡£å®Œæ•´æ–‡ä»¶ï¼ˆç”¨æˆ·+éƒ¨ç½²+API+éªŒæ”¶ï¼‰  
8. æœ€ç»ˆç›®å½•æ ‘ï¼ˆæ–‡ä»¶çº§æ¸…å•ï¼‰  
9. æœ€ç»ˆ Promptï¼ˆç»™å¤§æ¨¡å‹ï¼‰
 1. å‰ç«¯å®Œæ•´åŸå‹ï¼ˆVue3 + TS + Viteï¼‰
 1.1 ç›®å½•æ ‘ï¼ˆå‰ç«¯ï¼‰
frontend/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                     Axios å°è£…
â”‚   â”‚   â”œâ”€â”€ data.ts
â”‚   â”‚   â”œâ”€â”€ strategy.ts
â”‚   â”‚   â”œâ”€â”€ backtest.ts
â”‚   â”‚   â””â”€â”€ recommend.ts
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ DataManager.vue
â”‚   â”‚   â”œâ”€â”€ StrategyEditor.vue
â”‚   â”‚   â”œâ”€â”€ BacktestForm.vue
â”‚   â”‚   â”œâ”€â”€ ReportViewer.vue
â”‚   â”‚   â””â”€â”€ RecommendList.vue
â”‚   â”œâ”€â”€ router/
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”œâ”€â”€ stores/
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ websocket.ts
â”‚   â”‚   â””â”€â”€ theme.ts
â”‚   â”œâ”€â”€ App.vue
â”‚   â”œâ”€â”€ main.ts
â”‚   â””â”€â”€ style.css
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ tsconfig.json
 1.2 ä¸»è¦æ–‡ä»¶å†…å®¹ï¼ˆç›´æ¥ç”Ÿæˆï¼‰
 ï¼ˆ1ï¼‰main.ts
typescript
import { createApp } from 'vue';
import App from './App.vue';
import router from './router';
import { createPinia } from 'pinia';
import ElementPlus from 'element-plus';
import 'element-plus/dist/index.css';
import 'monaco-editor/esm/vs/basic-languages/python/python.contribution';
const app = createApp(App);
app.use(createPinia());
app.use(router);
app.use(ElementPlus);
app.mount('app');
 ï¼ˆ2ï¼‰App.vue
vue
<template>
  <el-container>
    <el-header>
      <el-menu mode="horizontal" :router="true">
        <el-menu-item index="/">é¦–é¡µ</el-menu-item>
        <el-menu-item index="/data">æ•°æ®ç®¡ç†</el-menu-item>
        <el-menu-item index="/strategy">ç­–ç•¥ç¼–è¾‘</el-menu-item>
        <el-menu-item index="/backtest">å›æµ‹</el-menu-item>
        <el-menu-item index="/recommend">æ¨è</el-menu-item>
      </el-menu>
    </el-header>
    <el-main>
      <router-view />
    </el-main>
  </el-container>
</template>
 ï¼ˆ3ï¼‰StrategyEditor.vueï¼ˆMonaco å®Œæ•´é…ç½®ï¼‰
vue
<template>
  <div class="strategy-editor">
    <MonacoEditor
      ref="editor"
      v-model="code"
      language="python"
      :theme="theme"
      :options="editorOptions"
      style="height: 600px"
    />
    <el-button type="primary" @click="save">ä¿å­˜</el-button>
  </div>
</template>
<script setup lang="ts">
import { ref } from 'vue';
import MonacoEditor from 'monaco-editor-vue3';
import { saveStrategy } from '@/api/strategy';
const code = ref(`import talib
g_params = {"fast": 5, "slow": 20}
def handle_data(context):
    pass`);
const theme = ref('vs-dark');
const editorOptions = {
  fontSize: 14,
  minimap: { enabled: false },
  scrollBeyondLastLine: false,
  wordWrap: 'on'
};
async function save() {
  await saveStrategy({ name: 'MyStrategy', code: code.value });
  ElMessage.success('å·²ä¿å­˜');
}
</script>
 ï¼ˆ4ï¼‰router/index.ts
typescript
import { createRouter, createWebHistory } from 'vue-router';
const routes = [
  { path: '/', redirect: '/data' },
  { path: '/data', component: () => import('@/components/DataManager.vue') },
  { path: '/strategy', component: () => import('@/components/StrategyEditor.vue') },
  { path: '/backtest', component: () => import('@/components/BacktestForm.vue') },
  { path: '/recommend', component: () => import('@/components/RecommendList.vue') }
];
export default createRouter({ history: createWebHistory(), routes });
 ï¼ˆ5ï¼‰stores/websocket.ts
typescript
import { defineStore } from 'pinia';
import { ref } from 'vue';
export const useWebSocketStore = defineStore('ws', () => {
  const socket = ref<WebSocket | null>(null);
  const logs = ref<string[]>([]);
  function connect(taskId: string) {
    socket.value = new WebSocket(`ws://localhost:8000/ws/${taskId}`);
    socket.value.onmessage = (e) => logs.value.push(e.data);
  }
  return { connect, logs };
});
 ï¼ˆ6ï¼‰package.jsonï¼ˆé”å®šç‰ˆæœ¬ï¼‰
json
{
  "name": "quant-web-frontend",
  "version": "1.0.0",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "dependencies": {
    "vue": "^3.4.0",
    "vue-router": "^4.2.5",
    "pinia": "^2.1.7",
    "element-plus": "^2.4.4",
    "monaco-editor-vue3": "^0.1.10",
    "axios": "^1.6.2"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.5.2",
    "typescript": "^5.3.3",
    "vite": "^5.0.10"
  }
}
 2. SQL å®Œæ•´æ–‡ä»¶
 2.1 init.sqlï¼ˆSQLite è¯­æ³•ï¼‰
sql
-- è‚¡ç¥¨åˆ—è¡¨
CREATE TABLE stock_basic (
    ts_code TEXT PRIMARY KEY,
    symbol TEXT NOT NULL,
    name TEXT NOT NULL,
    area TEXT,
    industry TEXT,
    list_date TEXT,
    data_source TEXT DEFAULT 'akshare' CHECK(data_source IN ('akshare','tushare')),
    status INTEGER DEFAULT 1 CHECK(status IN (0,1)),
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_sb_industry ON stock_basic(industry);
-- ç­–ç•¥å…ƒæ•°æ®
CREATE TABLE strategy (
    id TEXT PRIMARY KEY,
    name TEXT NOT NULL,
    code TEXT NOT NULL,
    params_json TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    version INTEGER DEFAULT 1
);
-- å›æµ‹ä»»åŠ¡
CREATE TABLE backtest_task (
    id TEXT PRIMARY KEY,
    strategy_id TEXT NOT NULL,
    stock_pool TEXT NOT NULL, -- JSON æ•°ç»„
    start_date TEXT NOT NULL,
    end_date TEXT NOT NULL,
    init_cash REAL NOT NULL,
    status TEXT CHECK(status IN ('Pending','Running','Success','Failed')),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    report_path TEXT
);
-- æ¨èç»“æœ
CREATE TABLE recommend_result (
    id TEXT PRIMARY KEY,
    task_id TEXT NOT NULL,
    trade_date TEXT NOT NULL,
    rank INTEGER NOT NULL,
    ts_code TEXT NOT NULL,
    score REAL NOT NULL,
    reason TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_rec_task ON recommend_result(task_id);
 2.2 seed.sqlï¼ˆåˆå§‹æ•°æ®ï¼‰
sql
-- 12 ç­–ç•¥æ¨¡æ¿
INSERT INTO strategy (id, name, code, params_json) VALUES
('tpl_ma', 'åŒå‡çº¿', 'import talib\ng_params={"fast":5,"slow":20}\ndef handle_data(ctx):\n    for stock in ctx.stocks:\n        close = Close(stock)\n        if len(close) < g_params["slow"]: continue\n        ma_fast = talib.MA(close, g_params["fast"])\n        ma_slow = talib.MA(close, g_params["slow"])\n        if ma_fast[-1] > ma_slow[-1] and MarketPosition(stock) == 0:\n            Buy(stock, 100, close[-1])\n        elif ma_fast[-1] < ma_slow[-1] and MarketPosition(stock) > 0:\n            Sell(stock, 100, close[-1])', '{"fast":5,"slow":20}');
-- ç¤ºä¾‹è‚¡ç¥¨ï¼ˆå¹³å®‰é“¶è¡Œã€æµ¦å‘é“¶è¡Œï¼‰
INSERT INTO stock_basic (ts_code, symbol, name, industry) VALUES
('000001.SZ', '000001', 'å¹³å®‰é“¶è¡Œ', 'é“¶è¡Œ'),
('600000.SH', '600000', 'æµ¦å‘é“¶è¡Œ', 'é“¶è¡Œ');
 2.3 migrate.shï¼ˆä¸€é”®è¿ç§»ï¼‰
bash
!/bin/bash
set -e
echo "[Migrate] Start..."
alembic upgrade head
echo "[Migrate] Done."
 3. è¿ç»´å®Œæ•´è„šæœ¬
 3.1 backup.shï¼ˆå®Œæ•´å¤‡ä»½ï¼‰
bash
!/bin/bash
set -e
DATE=$(date +%F)
BACKUP_DIR="./backup"
mkdir -p $BACKUP_DIR
tar -zcf $BACKUP_DIR/quant_$DATE.tar.gz ./data ./logs
aws s3 cp $BACKUP_DIR/quant_$DATE.tar.gz s3://your-bucket/backup/ || echo "S3 æœªé…ç½®ï¼Œä¿ç•™æœ¬åœ°"
echo "[Backup] å®Œæˆ $BACKUP_DIR/quant_$DATE.tar.gz"
 3.2 health_check.sh
bash
!/bin/bash
set -e
CPU=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
MEM=$(free | grep Mem | awk '{printf("%.1f", $3/$2  100.0)}')
DISK=$(df ./data | tail -1 | awk '{print $5}' | cut -d'%' -f1)
if (( $(echo "$CPU > 80" | bc -l) )) || (( $(echo "$MEM > 80" | bc -l) )) || [ $DISK -gt 80 ]; then
  echo "ALERT: CPU=$CPU% MEM=$MEM% DISK=$DISK%" | mail -s "QuantWeb å‘Šè­¦" admin@example.com
fi
 3.3 upgrade.sh
bash
!/bin/bash
set -e
echo "[Upgrade] å¼€å§‹å¤‡ä»½..."
./backup.sh
echo "[Upgrade] åœæ­¢æœåŠ¡..."
docker-compose down
echo "[Upgrade] æ‹‰å–æœ€æ–°é•œåƒ..."
docker-compose pull
echo "[Upgrade] æ•°æ®åº“è¿ç§»..."
docker-compose run --rm web alembic upgrade head
echo "[Upgrade] å¯åŠ¨æœåŠ¡..."
docker-compose up -d
echo "[Upgrade] å®Œæˆã€‚"
 4. æµ‹è¯•å®Œæ•´æ–‡ä»¶
 4.1 tests/unit/test_dm.py
python
import asyncio
from quant_web.core.dm.akshare_adapter import AkShareAdapter
def test_download_daily():
    adapter = AkShareAdapter()
    df = asyncio.run(adapter.download_daily("000001.SZ", "20230101", "20231231"))
    assert len(df) >= 240
    assert df.isnull().sum().sum() == 0
 4.2 tests/integration/test_backtest.py
python
import asyncio
from quant_web.api.v1.backtest import submit_backtest
from quant_web.core.be.engine import BacktestEngine
def test_backtest_flow():
    req = {
        "strategy_id": "tpl_ma",
        "stock_pool": ["000001.SZ"],
        "start_date": "20230101",
        "end_date": "20231231",
        "init_cash": 100000,
        "params": {"fast": 5, "slow": 20}
    }
    resp = asyncio.run(submit_backtest(req))
    assert resp["task_id"].startswith("BK_")
 4.3 tests/perf/locustfile.py
python
from locust import HttpUser, task, between
class QuantUser(HttpUser):
    wait_time = between(1, 3)
    @task
    def submit_backtest(self):
        self.client.post("/api/v1/backtest/submit", json={
            "strategy_id": "tpl_ma",
            "stock_pool": ["000001.SZ"],
            "start_date": "20230101",
            "end_date": "20231231",
            "init_cash": 100000,
            "params": {"fast": 5, "slow": 20}
        })
 5. Docker å®Œæ•´æ–‡ä»¶
 5.1 Dockerfile
dockerfile
FROM python:3.11-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
COPY . .
EXPOSE 8000
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000", "--workers", "4"]
 5.2 docker-compose.yml
yaml
version: "3.8"
services:
  web:
    build: .
    ports: ["8000:8000"]
    env_file: .env
    depends_on: [redis]
    volumes: ["./data:/app/data", "./logs:/app/logs"]
  redis:
    image: redis:7-alpine
    ports: ["6379:6379"]
    volumes: ["redis_data:/data"]
  worker:
    build: .
    command: celery -A tasks worker --loglevel=info --concurrency=4
    depends_on: [redis]
    volumes: ["./data:/app/data", "./logs:/app/logs"]
volumes:
  redis_data:
 5.3 .env.example
 æ•°æ®åº“
DATABASE_URL=sqlite:///./data/quant.db
 Redis
REDIS_URL=redis://redis:6379/0
 JWTï¼ˆå¯é€‰ï¼‰
JWT_SECRET=your-secret
 SMTPï¼ˆå¯é€‰ï¼‰
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_USER=admin@example.com
SMTP_PASS=your-password
 6. CI/CD å®Œæ•´æ–‡ä»¶
 6.1 .github/workflows/ci.yml
yaml
name: CI
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with: {python-version: '3.11'}
      - run: pip install -r requirements.txt
      - run: pip-audit
      - run: pytest --cov=80 --cov-report=xml
      - run: locust -f tests/perf/locustfile.py --headless -u 10 -r 2 -t 30s --csv=perf
      - run: docker build -t quant-web .
 6.2 .github/workflows/cd.yml
yaml
name: CD
on:
  push:
    tags: ["v"]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: docker-compose down
      - run: docker-compose pull
      - run: docker-compose up -d
 6.3 .github/workflows/release.yml
yaml
name: Release
on:
  push:
    tags: ["v"]
jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: docker build -t quant-web:${GITHUB_REF_NAME} .
      - run: echo "Release ${GITHUB_REF_NAME}" >> release_notes.md
      - uses: softprops/action-gh-release@v1
        with:
          files: release_notes.md
          tag_name: ${{ github.ref_name }}
 7. æ–‡æ¡£å®Œæ•´æ–‡ä»¶
 7.1 docs/user_manual.md
markdown
 ç”¨æˆ·æ‰‹å†Œ
 1. å¿«é€Ÿå¼€å§‹
1. æµè§ˆå™¨è®¿é—® http://localhost:8000
2. ç‚¹å‡»â€œæ•°æ®ç®¡ç†â€â†’é€‰æ‹©è‚¡ç¥¨â†’ä¸‹è½½
3. ç‚¹å‡»â€œç­–ç•¥ç¼–è¾‘â€â†’é€‰æ‹©æ¨¡æ¿â†’ä¿å­˜
4. ç‚¹å‡»â€œå›æµ‹â€â†’æäº¤ä»»åŠ¡â†’æŸ¥çœ‹æŠ¥å‘Š
5. ç‚¹å‡»â€œæ¨èâ€â†’ç”Ÿæˆ Top-N åˆ—è¡¨
 7.2 docs/deploy.md
markdown
 éƒ¨ç½²æ‰‹å†Œ
 Docker ä¸€é”®éƒ¨ç½²
bash
docker-compose up -d
è®¿é—® http://localhost:8000
 7.3 docs/api.md
markdown
 API æ–‡æ¡£
[Swagger UI](http://localhost:8000/docs)
 7.4 docs/acceptance_report.md
markdown
 éªŒæ”¶æŠ¥å‘Š
- åŠŸèƒ½ï¼šâœ… å…¨éƒ¨é€šè¿‡
- æ€§èƒ½ï¼šâœ… P95 â‰¤ 500ms
- å¹¶å‘ï¼šâœ… 3 ä»»åŠ¡æ— å´©æºƒ
- å¤‡ä»½ï¼šâœ… æ¼”ç»ƒæˆåŠŸ
éªŒæ”¶äººï¼š_________ æ—¥æœŸï¼š_________
 8. æœ€ç»ˆç›®å½•æ ‘ï¼ˆæ–‡ä»¶çº§æ¸…å•ï¼‰
quant_web/
â”œâ”€â”€ main.py
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ .env.example
â”œâ”€â”€ api/v1/
â”‚   â”œâ”€â”€ data.py
â”‚   â”œâ”€â”€ strategy.py
â”‚   â”œâ”€â”€ backtest.py
â”‚   â””â”€â”€ recommend.py
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ const.py
â”‚   â”œâ”€â”€ dm/akshare_adapter.py
â”‚   â”œâ”€â”€ sm/syntax_checker.py
â”‚   â”œâ”€â”€ be/matcher.py
â”‚   â”œâ”€â”€ re/factor_model.py
â”‚   â””â”€â”€ vis/report_generator.py
â”œâ”€â”€ models/database.py
â”œâ”€â”€ tasks.py
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/test_dm.py
â”‚   â”œâ”€â”€ integration/test_backtest.py
â”‚   â””â”€â”€ perf/locustfile.py
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ run.bat
â”‚   â”œâ”€â”€ run.sh
â”‚   â”œâ”€â”€ backup.sh
â”‚   â”œâ”€â”€ restore.sh
â”‚   â”œâ”€â”€ health_check.sh
â”‚   â””â”€â”€ upgrade.sh
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ user_manual.md
â”‚   â”œâ”€â”€ deploy.md
â”‚   â”œâ”€â”€ api.md
â”‚   â””â”€â”€ acceptance_report.md
â”œâ”€â”€ .github/workflows/
â”‚   â”œâ”€â”€ ci.yml
â”‚   â”œâ”€â”€ cd.yml
â”‚   â””â”€â”€ release.yml
â”œâ”€â”€ sql/
â”‚   â”œâ”€â”€ init.sql
â”‚   â”œâ”€â”€ seed.sql
â”‚   â””â”€â”€ migrate.sh
frontend/
â”œâ”€â”€ package.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts
â”‚   â”œâ”€â”€ App.vue
â”‚   â”œâ”€â”€ router/index.ts
â”‚   â”œâ”€â”€ stores/websocket.ts
â”‚   â”œâ”€â”€ components/StrategyEditor.vue
â”‚   â”œâ”€â”€ components/DataManager.vue
â”‚   â”œâ”€â”€ components/BacktestForm.vue
â”‚   â”œâ”€â”€ components/ReportViewer.vue
â”‚   â””â”€â”€ components/RecommendList.vue
 9. æœ€ç»ˆ Promptï¼ˆç»™å¤§æ¨¡å‹ï¼‰
è¯·ä¾æ®ä»¥ä¸Šå…¨éƒ¨å†…å®¹ï¼ˆv6.0-Finalï¼‰ï¼Œä¸€æ¬¡æ€§ç”Ÿæˆå®Œæ•´ã€å¯è¿è¡Œã€é›¶æ­§ä¹‰çš„ã€Œä¸ªäººé‡åŒ–æŠ•ç ” Web å¹³å°ã€å…¨éƒ¨æºä»£ç ã€SQLã€Dockerã€æ–‡æ¡£ã€æµ‹è¯•ã€è¿ç»´è„šæœ¬ï¼Œå¹¶ç¡®ä¿ï¼š
1. æ‰€æœ‰å¸¸é‡ã€å­—æ®µã€è·¯å¾„ã€å‘½åã€é”™è¯¯ç ä¸æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
2. æ‰€æœ‰åˆ†æ”¯ã€å¼‚å¸¸ã€é‡è¯•ã€æ»‘ç‚¹ã€æƒé‡ã€å…¬å¼ä¸æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
3. æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ã€æ€§èƒ½é—¨ç¦ã€CI/CDã€ä¸Šçº¿æ¸…å•ä¸æ–‡æ¡£å®Œå…¨ä¸€è‡´ï¼›
4. ç”Ÿæˆåæ‰§è¡Œ `docker-compose up` å³å¯è®¿é—® http://localhost:8000 ä½¿ç”¨å…¨éƒ¨åŠŸèƒ½ï¼›
5. ç”Ÿæˆå®Œæ¯•åè¾“å‡ºï¼šç›®å½•æ ‘ï¼ˆå‰ 20 æ–‡ä»¶ï¼‰+ ä¸€é”®å¯åŠ¨å‘½ä»¤ã€‚
ç¦æ­¢é—æ¼ä»»ä½•æ–‡ä»¶ï¼›ç¦æ­¢å‡ºç°ä»»ä½• TODO æˆ–å ä½ç¬¦ï¼›ç¦æ­¢éœ€è¦äººå·¥ä¿®æ”¹ã€‚
è¦è®©å¤§æ¨¡å‹ï¼ˆæˆ–ä¸€ä¸ªå·¥ç¨‹å›¢é˜Ÿï¼‰çœŸæ­£é›¶æ­§ä¹‰ã€ä¸€æ¬¡æ€§åœ°ç”Ÿæˆå‡ºè¿™ä»½æ–‡æ¡£æ‰€æè¿°çš„ã€Œä¸ªäººé‡åŒ–æŠ•ç ” Web å¹³å°ã€å¯è¿è¡Œå®Œæ•´ç³»ç»Ÿï¼Œæ–‡æ¡£è¿˜éœ€è¦è¡¥å……ä»¥ä¸‹ 8 å¤§ç±»ã€å…± 60+ é¡¹â€œæœ€åä¸€å…¬é‡Œâ€ç»†èŠ‚ã€‚ç¼ºä»»ä½•ä¸€é¡¹ï¼Œéƒ½ä¼šå¯¼è‡´â€œçœ‹èµ·æ¥éƒ½å†™äº†ï¼Œä¸€è·‘å°±æŠ¥é”™â€ã€‚
 1. è¿è¡Œæ—¶ä¾èµ–ï¼šç‰ˆæœ¬ & å®‰è£…æº
| ç¼ºä»€ä¹ˆ | è¡¥å……åˆ°ä»€ä¹ˆç²’åº¦ | ç¤ºä¾‹ |
| Python è§£é‡Šå™¨ç‰ˆæœ¬ | ç²¾ç¡®åˆ° patch | `python 3.11.7`ï¼ˆ3.11.8 èµ· numpy 1.26.2 ä¼šç¼–è¯‘è­¦å‘Šï¼‰ |
| Node ç‰ˆæœ¬ | `.nvmrc` æ–‡ä»¶ | `18.19.0`ï¼ˆvite 5.0.10 æœ€ä½ï¼‰ |
| ç³»ç»Ÿçº§åº“ | apt/yum åˆ—è¡¨ | `libgomp1`ã€`libhdf5-serial-dev`ï¼ˆakshare ä¾èµ–ï¼‰ |
| å›½å†…æº | å®Œæ•´ pip é•œåƒ | `-i https://pypi.tuna.tsinghua.edu.cn/simple` |
| pnpm/npm æº | `.npmrc` | `registry=https://registry.npmmirror.com` |
 2. å‰ç«¯æ„å»ºæµæ°´çº¿
| ç¼ºä»€ä¹ˆ | è¡¥å……åˆ°ä»€ä¹ˆç²’åº¦ | ç¤ºä¾‹ |
| æ„å»ºè„šæœ¬ | ç²¾ç¡®å‘½ä»¤ | `npm run build` äº§ç‰© `dist/` è¢« `nginx:alpine` é•œåƒæ‰˜ç®¡ |
| ç¯å¢ƒå˜é‡ | æšä¸¾ | `VITE_API_BASE=http://localhost:8000/api/v1` |
| ç±»å‹æ£€æŸ¥ | `vue-tsc --noEmit` | CI é—¨ç¦å¿…é¡»è¿‡ |
| åŒ…ä½“ç§¯é—¨ç¦ | `bundlesize` | `dist/assets/.js â‰¤ 800 kB` gzip |
| æµè§ˆå™¨å…¼å®¹ | `.browserslistrc` | `> 1%, last 2 years, not dead` |
 3. æ•°æ®åº“â€œç©ºè¡¨â€åˆå§‹çŠ¶æ€
| ç¼ºä»€ä¹ˆ | è¡¥å……åˆ°ä»€ä¹ˆç²’åº¦ | ç¤ºä¾‹ |
| SQLite æ–‡ä»¶å·²å­˜åœ¨åœºæ™¯ | å†²çªç­–ç•¥ | `alembic stamp head` å‰å…ˆ `quant.db` md5 æ ¡éªŒ |
| MySQL åˆ‡åº“ | å­—ç¬¦é›† & æ—¶åŒº | `charset=utf8mb4 collate=utf8mb4_0900_ai_ci` `SET time_zone='+8:00'` |
| ç§å­æ•°æ® idempotent | `INSERT OR IGNORE` | é‡å¤æ‰§è¡Œä¸æŠ›ä¸»é”®å†²çª |
| åˆ†åŒºè¡¨è‡ªåŠ¨æ‰©å±• | äº‹ä»¶è°ƒåº¦ | 2025 æ–°è¡¨ `PARTITION p2025 VALUES LESS THAN (2026)` ç”± `sys_event` æå‰åˆ›å»º |
 4. ç­–ç•¥æ²™ç®±â€œç™½åå•â€ & æ³¨å…¥ API
| ç¼ºä»€ä¹ˆ | è¡¥å……åˆ°ä»€ä¹ˆç²’åº¦ | ç¤ºä¾‹ |
| å…è®¸ import æ¸…å• | ç²¾ç¡®åˆ°æ¨¡å—çº§ | `numpy`, `pandas`, `talib`, `scipy.stats`, `sklearn.preprocessing` |
| æ³¨å…¥å‡½æ•°ç­¾å | ç±»å‹æ³¨è§£ | `def Buy(ts_code: str, qty: int, price: float) -> str:` |
| å…¨å±€å˜é‡ç”Ÿå‘½å‘¨æœŸ | è¯´æ˜æ–‡æ¡£ | `g_params` åœ¨ `initialize()` æ—¶æ³¨å…¥ï¼Œå›æµ‹ç»“æŸå›æ”¶ |
| ç¦æ­¢è¯­æ³• | AST é»‘åå• | `import ast; ast.Name(id='open')` è§¦å‘ `SyntaxError` |
| è¶…æ—¶æ§åˆ¶ | å­è¿›ç¨‹ | `resource.setrlimit(RLIMIT_CPU, (3060, 3060))` |
 5. é”™è¯¯ç  & é‡è¯•çŸ©é˜µ
| ç¼ºä»€ä¹ˆ | è¡¥å……åˆ°ä»€ä¹ˆç²’åº¦ | ç¤ºä¾‹ |
| ä¸šåŠ¡é”™è¯¯ç è¡¨ | å”¯ä¸€ 5 ä½æ•°å­— | `40001` æ—¥æœŸæ ¼å¼é”™ï¼Œ`40002` è‚¡ç¥¨ä»£ç ä¸å­˜åœ¨ |
| é‡è¯•ç­–ç•¥ | æŒ‡æ•°é€€é¿å…¬å¼ | `sleep = base  2attempt + random.uniform(0, 1)` |
| ç†”æ–­é˜ˆå€¼ | å¯è§‚æµ‹æŒ‡æ ‡ | è¿ç»­ 5 æ¬¡ `40002` è§¦å‘ 15 min ç†”æ–­ï¼Œåœç”¨è¯¥æ•°æ®æº |
| ç”¨æˆ·æç¤ºæ–‡æ¡ˆ | å¤šè¯­è¨€ | `zh-CN`ï¼šâ€œèµ·å§‹æ—¥æœŸä¸èƒ½å¤§äºä»Šæ—¥â€ |
 6. æ—¥å¿—è§„èŒƒ & å¯è§‚æµ‹
| ç¼ºä»€ä¹ˆ | è¡¥å……åˆ°ä»€ä¹ˆç²’åº¦ | ç¤ºä¾‹ |
| æ—¥å¿—æ ¼å¼ | JSON schema | `{"t":"2025-06-01T12:00:00.000Z","lvl":"INFO","trace_id":"bk_123","mod":"be.matcher","msg":"trade executed","extra":{"price":10.12}}` |
| æ—¥å¿—é‡‡æ · | é…ç½®å¼€å…³ | é«˜å¹¶å‘æ—¶åªé‡‡æ · 10% `INFO`ï¼Œ`ERROR` å…¨é‡‡ |
| åº¦é‡æŒ‡æ ‡ | Prometheus | `backtest_duration_seconds{strategy_id="tpl_ma"}` Counter |
| é“¾è·¯è¿½è¸ª | OpenTelemetry | `traceparent` é€ä¼  headers |
 7. æµ‹è¯• fixtures & ç§å­æ•°æ®
| ç¼ºä»€ä¹ˆ | è¡¥å……åˆ°ä»€ä¹ˆç²’åº¦ | ç¤ºä¾‹ |
| æœ€å°å¯è¿è¡Œæ•°æ®é›† | CSV | `000001.SZ 2023-01-03 ~ 2023-01-10` 8 æ¡æ—¥çº¿ï¼Œå«æƒæ¯ |
| mock å¤–éƒ¨æ•°æ®æº | `pytest-httpx` | AkShare è¿”å› HTML 504 æ—¶èµ° `respx.MockRouter` |
| æ€§èƒ½åŸºçº¿æ–‡ä»¶ | `.pkl` | æŠŠ 1 å¹´ 000001 é¢„æœŸç»“æœåºåˆ—åŒ–ï¼Œå•å…ƒæµ‹è¯•æ–­è¨€è¯¯å·® `< 1e-4` |
| å¹¶å‘å‹æµ‹åœºæ™¯ | `locustfile.py` | 10 ç”¨æˆ·å„æäº¤ 3 ä»»åŠ¡ï¼ŒRamp-up 30 sï¼ŒHold 60 s |
 8. ä¸€é”®è„šæœ¬â€œå¹‚ç­‰ & å›æ»šâ€
| ç¼ºä»€ä¹ˆ | è¡¥å……åˆ°ä»€ä¹ˆç²’åº¦ | ç¤ºä¾‹ |
| å®‰è£…è„šæœ¬ | å¹‚ç­‰æ£€æµ‹ | `if [[ -f .installed ]] ; then echo "Skip pip install"; fi` |
| å‡çº§å›æ»š | æ•°æ®åº“ç‰ˆæœ¬ | `alembic downgrade -1` è‡ªåŠ¨è§¦å‘ `quant.db.backup` |
| æ•°æ®ç›®å½•æƒé™ | æ•°å­—æ¨¡å¼ | `chmod 750 ./data ./logs; chown 1000:1000`ï¼ˆå®¹å™¨å†… uidï¼‰ |
| Windows é•¿è·¯å¾„ | `\\?\` å‰ç¼€ | `robocopy` æ›¿ä»£ `cp` é˜²æ­¢ 260 å­—ç¬¦æº¢å‡º |
| å¸è½½è„šæœ¬ | æ¸…ç†åˆ—è¡¨ | åˆ é™¤é•œåƒã€å·ã€æœ¬åœ° `~/.quant-web` é…ç½®ç›®å½• |
 ğŸ“Œ äº¤ä»˜ checklistï¼ˆè¡¥å……å®Œæ¯•åï¼‰
- [ ] æä¾› `complete-v6.1.zip` â†’ è§£å‹ â†’ `docker-compose up` â†’ æµè§ˆå™¨ `http://localhost:8000` ç›´æ¥çœ‹åˆ°ç™»å½•åé¦–é¡µ
- [ ] å•å…ƒæµ‹è¯• `pytest` 100% é€šè¿‡ï¼Œæ—  skipped
- [ ] å‰ç«¯ `npm run build` é€šè¿‡ä¸” bundle â‰¤ 800 kB
- [ ] å‹æµ‹ `locust -u 10 -t 60s` é”™è¯¯ç‡ 0%ï¼ŒP95 â‰¤ 500 ms
- [ ] ç­–ç•¥æ²™ç®±æ‰§è¡Œ `import os` ç«‹å³æŠ› `SyntaxError: illegal import`
- [ ] å‡çº§è„šæœ¬ `./scripts/upgrade.sh v1.0 v1.1` å›æ»šåæ•°æ®åº“è¡Œæ•°ä¸€è‡´
 âœ… ç»“è®º
åªæœ‰æŠŠä¸Šè¿° 60+ é¡¹â€œé¢—ç²’åº¦â€å…¨éƒ¨æ–‡æ¡£åŒ–ã€è„šæœ¬åŒ–ã€é—¨ç¦åŒ–ï¼Œå¤§æ¨¡å‹æ‰èƒ½ä¸€æ¬¡æ€§åå‡ºå¯è¿è¡Œã€é›¶äººå·¥ä¿®å¤çš„é‡åŒ–ç³»ç»Ÿã€‚  
æ¢å¥è¯è¯´ï¼š
> æ–‡æ¡£çš„ç»ˆç‚¹ä¸æ˜¯â€œè®²æ¸…æ¥šâ€ï¼Œè€Œæ˜¯â€œæœºå™¨èƒ½ä¸€æ¬¡æ€§å¤åˆ¶æˆåŠŸâ€ã€‚
 å¿…é¡»ç¡®è®¤é¡¹æ¸…å•ï¼ˆç”¨äºç”Ÿæˆå¯ç›´æ¥è¿è¡Œçš„ QuantWeb å·¥ç¨‹ï¼‰
æ›´æ–°ï¼š2025-11-10
ç›®çš„ï¼šæŠŠä¹‹å‰ä¼šè¯ä¸­è¯†åˆ«å‡ºçš„â€œé«˜é£é™©/å¿…é¡»ç¡®è®¤â€çš„é…ç½®é¡¹ä»¥æ¸…å•å½¢å¼å†™å…¥ä»“åº“ï¼Œä¾¿äºä½ é€é¡¹ç¡®è®¤æˆ–æ¥å—é»˜è®¤å€¼ï¼Œä»¥ä¾¿æˆ‘ç»§ç»­ç”Ÿæˆå®Œæ•´å·¥ç¨‹éª¨æ¶ã€‚
è¯´æ˜ï¼šæ¯ä¸€é¡¹åŒ…å«ï¼šè¦ç¡®è®¤çš„å†…å®¹ / å»ºè®®é»˜è®¤å€¼ / ä¸ºä»€ä¹ˆå¿…é¡»ç¡®è®¤ / è‹¥ä¸ç¡®è®¤çš„é£é™©ã€‚
 é«˜ä¼˜å…ˆçº§ï¼ˆå¿…é¡»ç«‹å³ç¡®è®¤ï¼‰
1. Python ç²¾ç¡®ç‰ˆæœ¬
   - è¦ç¡®è®¤ï¼šä¸»æœºä¸ Docker ä¸­ä½¿ç”¨çš„ Python ç²¾ç¡®ç‰ˆæœ¬ï¼ˆå« patchï¼‰
   - å»ºè®®ï¼š`3.11.7`
   - åŸå› ï¼šéƒ¨åˆ†ä¾èµ–ï¼ˆå¦‚ numpy/pandas/akshareï¼‰å¯¹ Python patch ç‰ˆæœ¬æ•æ„Ÿï¼Œå½±å“äºŒè¿›åˆ¶å…¼å®¹
   - é£é™©ï¼šä¾èµ–å®‰è£…å¤±è´¥æˆ–è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¯¼è‡´æ— æ³•ç›´æ¥ `docker-compose up`ã€‚
2. Node / npm / pnpm ç‰ˆæœ¬ï¼ˆå‰ç«¯ï¼‰
   - è¦ç¡®è®¤ï¼šNode ç‰ˆæœ¬ä¸åŒ…ç®¡ç†å™¨ï¼ˆå¹¶åŠ å…¥ `.nvmrc`ï¼‰
   - å»ºè®®ï¼š`Node 18.19.0`ï¼Œä½¿ç”¨ `npm` æˆ– `pnpm`ï¼ˆè¯·é€‰æ‹©å…¶ä¸€ï¼‰
   - åŸå› ï¼šVite ä¸æŸäº›å‰ç«¯ä¾èµ–å¯¹ Node ç‰ˆæœ¬æœ‰æœ€ä½è¦æ±‚
   - é£é™©ï¼šå‰ç«¯æ„å»ºå¤±è´¥ï¼Œå½±å“æ•´ä½“äº¤ä»˜
3. ç³»ç»Ÿçº§åº“ï¼ˆDocker åŸºç¡€é•œåƒæ‰€éœ€ï¼‰
   - è¦ç¡®è®¤ï¼šæ˜¯å¦åœ¨ Dockerfile ä¸­å®‰è£… `libgomp1`, `libhdf5-serial-dev`, `build-essential` ç­‰
   - å»ºè®®ï¼šåœ¨ Dockerfile ä¸­å®‰è£…å¸¸è§ç³»ç»Ÿä¾èµ–å¹¶æä¾›æ³¨é‡Š
   - åŸå› ï¼šakshare / numpy ç­‰å¯èƒ½éœ€è¦æœ¬åœ°ç³»ç»Ÿåº“æ”¯æŒ
   - é£é™©ï¼š`pip install` ç¼–è¯‘/è¿è¡Œå¤±è´¥
4. æ•°æ®åº“é€‰æ‹©ä¸è¿ç§»ç­–ç•¥
   - è¦ç¡®è®¤ï¼šé»˜è®¤ä½¿ç”¨ SQLite è¿˜æ˜¯ MySQL ä»¥åŠ alembic åœ¨å·²å­˜åœ¨ DB çš„è¡Œä¸º
   - å»ºè®®ï¼šé»˜è®¤ `SQLite`ï¼ˆ`sqlite:///./data/quant.db`ï¼‰ï¼ŒåŒæ—¶æ–‡æ¡£ä¸­è¯´æ˜ MySQL é…ç½®ï¼›è¿ç§»å‰è‡ªåŠ¨å¤‡ä»½ `quant.db`ã€‚
   - åŸå› ï¼šDDL æ–‡æ¡£åŒ…å« MySQL ä¸“ç”¨åˆ†åŒºè¯­å¥ï¼Œéœ€åŒºåˆ†è¿è¡Œæ—¶ DB ç±»å‹
   - é£é™©ï¼šåœ¨ SQLite ä¸Šæ‰§è¡Œ MySQL DDL å¯¼è‡´è¿ç§»å¤±è´¥æˆ–æ•°æ®ä¸¢å¤±
5. ç­–ç•¥æ²™ç®±ç™½åå•ä¸èµ„æºé™åˆ¶
   - è¦ç¡®è®¤ï¼šå…è®¸ç­–ç•¥ `import` çš„æ¨¡å—æ¸…å•ã€ç¦æ­¢è¯­æ³•ã€å•ç­–ç•¥è¶…æ—¶æ—¶é—´ã€å†…å­˜ä¸Šé™å®ç°æ–¹å¼
   - å»ºè®®ç™½åå•ï¼š`numpy, pandas, talib, math, statistics`ï¼›è¶…æ—¶ 30 åˆ†é’Ÿï¼›å†…å­˜é™åˆ¶ 2GBï¼ˆå­è¿›ç¨‹ + `resource.setrlimit`ï¼‰
   - åŸå› ï¼šç­–ç•¥å¯æ‰§è¡Œä»»æ„ Pythonï¼Œå¿…é¡»é˜²æ­¢è¶Šæƒè®¿é—®ä¸èµ„æºè€—å°½
   - é£é™©ï¼šå¹³å°è¢«æ¶æ„æˆ–é”™è¯¯ç­–ç•¥ç ´åã€æ•°æ®æ³„éœ²æˆ–æœåŠ¡ä¸å¯ç”¨
6. ä¸šåŠ¡é”™è¯¯ç å®Œæ•´è¡¨
   - è¦ç¡®è®¤ï¼šå…¨éƒ¨ä¸šåŠ¡é”™è¯¯ç ï¼ˆ5 ä½ï¼‰ä¸å¯¹åº”å‰ç«¯æ–‡æ¡ˆ
   - å»ºè®®ï¼šä¿ç•™ `40001..40100` èŒƒå›´ç”¨äºå¸¸è§è¾“å…¥/ä¸šåŠ¡é”™è¯¯ï¼Œå¹¶åœ¨æ–‡æ¡£ä¸­åˆ—ä¸¾å·²ç”¨ç 
   - åŸå› ï¼šå‰ç«¯/æµ‹è¯•/æ—¥å¿—éœ€ä¸€è‡´çš„é”™è¯¯ç ä»¥ä¾¿æ–­è¨€ä¸ç”¨æˆ·æç¤º
   - é£é™©ï¼šæµ‹è¯•æ–­è¨€å¤±è´¥æˆ–å‰ç«¯æç¤ºæ··ä¹±
 ä¸­ä¼˜å…ˆçº§ï¼ˆå¼€å‘é˜¶æ®µéœ€ç¡®è®¤ï¼‰
7. ç§å­æ•°æ®ä¸å¹‚ç­‰å¯¼å…¥ç­–ç•¥
   - è¦ç¡®è®¤ï¼šseed.sql æ˜¯å¦é‡‡ç”¨ `INSERT OR IGNORE` æˆ– idempotent è„šæœ¬ï¼›æä¾›æœ€å°æµ‹è¯•æ•°æ®é›†
   - å»ºè®®ï¼šæä¾›æœ€å° CSVï¼ˆ1 æ”¯è‚¡ç¥¨ 8~10 æ¡æ—¥çº¿ï¼‰ç”¨äº CIï¼›seed ä½¿ç”¨ `INSERT OR IGNORE`
   - é£é™©ï¼šé‡å¤å¯¼å…¥ä¸»é”®å†²çªæˆ–æµ‹è¯•ä¸ç¨³å®š
8. å¤–éƒ¨æœåŠ¡å‡­æ®ä¸ `.env` ç­–ç•¥
   - è¦ç¡®è®¤ï¼šSMTPã€S3ã€TUSHARE key ç­‰æ˜¯å¦æ”¾å…¥ `.env`ï¼Œä»¥åŠç¼ºå¤±æ—¶çš„ä¼˜é›…é™çº§ç­–ç•¥
   - å»ºè®®ï¼šä¿ç•™ `.env.example`ï¼Œè¿è¡Œæ—¶ç¼ºçœå€¼å¯¼è‡´åŠŸèƒ½ç¦ç”¨å¹¶è®°å½•æ—¥å¿—å‘Šè­¦
   - é£é™©ï¼šéƒ¨ç½²ç¯å¢ƒå› å‡­æ®ç¼ºå¤±å´©æºƒ
9. å‰ç«¯ API åŸºç¡€è·¯å¾„ä¸æ„å»ºç¯å¢ƒå˜é‡
   - è¦ç¡®è®¤ï¼š`VITE_API_BASE` çš„é»˜è®¤å€¼ä¸å®¹å™¨å†…åç«¯ä¸»æœºå
   - å»ºè®®ï¼šå¼€å‘ `http://localhost:8000/api/v1`ï¼Œdocker-compose å†…ä½¿ç”¨ `http://web:8000/api/v1`
   - é£é™©ï¼šè·¨åŸŸ/CORS æˆ–å‰ç«¯è¯·æ±‚å¤±è´¥
10. æ—¥å¿—æ ¼å¼ã€é‡‡æ ·ä¸è¿½è¸ªç­–ç•¥
    - è¦ç¡®è®¤ï¼šæ˜¯å¦å¯ç”¨ JSON æ—¥å¿—ã€Prometheusã€OpenTelemetry
    - å»ºè®®ï¼šJSON æ—¥å¿—ï¼ˆloguruï¼‰ï¼Œå…³é”®åº¦é‡ Prometheusï¼ˆåç»­æ‰©å±•ï¼‰
    - é£é™©ï¼šç¼ºå°‘å¯è§‚æµ‹æ€§ï¼Œæ•…éšœæ’æŸ¥å›°éš¾
11. å¤‡ä»½/æ¢å¤ä¸ S3 é…ç½®
    - è¦ç¡®è®¤ï¼šå¤‡ä»½é¢‘ç‡ã€ä¿ç•™å¤©æ•°ä¸ S3 æ¡¶ä¿¡æ¯
    - å»ºè®®ï¼šé»˜è®¤æœ¬åœ°æ¯æ—¥å¤‡ä»½ 7 å¤©ä¿ç•™ï¼›S3 ä¸ºå¯é€‰éœ€åœ¨ `.env` å¡«å†™å‡­æ®
    - é£é™©ï¼šæ•°æ®æ— æ³•æ¢å¤
 ä½ä¼˜å…ˆçº§ï¼ˆè¿­ä»£ç¡®è®¤å³å¯ï¼‰
12. å‰ç«¯æ„å»ºé—¨ç¦ï¼ˆç±»å‹æ£€æŸ¥ã€bundle å¤§å°ï¼‰
    - å»ºè®®ï¼šCI å¼ºåˆ¶ `vue-tsc --noEmit`ï¼Œbundle gzip é™åˆ¶ï¼ˆä¾‹å¦‚ â‰¤ 800 KBï¼‰
13. CI æ€§èƒ½æµ‹è¯•é˜ˆå€¼
    - å»ºè®®ï¼šCI åšè½»é‡ locust å¿«ç…§ï¼ˆ10 users, 30sï¼‰ï¼Œé‡è´Ÿè½½åœºæ™¯å•ç‹¬æµæ°´çº¿
14. Alembic ä¸åˆ†åŒºè¡¨ç­–ç•¥
    - å»ºè®®ï¼šè¿ç§»è„šæœ¬æ ¹æ® `DATABASE_URL` åˆ¤æ–­ DB ç±»å‹å¹¶é€‰æ‹©ç›¸åº” DDL
15. å‘Šè­¦æ¥æ”¶äººï¼ˆé‚®ä»¶ï¼‰
    - å»ºè®®ï¼š`.env` ä¸­é…ç½® `ADMIN_EMAILS`ï¼Œç¼ºå¤±åˆ™ä»…è®°å½•æ—¥å¿—
16. CORS ç­–ç•¥
    - å»ºè®®ï¼šå¼€å‘ç¯å¢ƒå…è®¸ ``ï¼Œç”Ÿäº§ç¯å¢ƒé€šè¿‡ `.env` æŒ‡å®šç™½åå•
17. Docker èµ„æºé™åˆ¶ä¸é‡å¯ç­–ç•¥
    - å»ºè®®ï¼šä¸º `web`/`worker` è®¾ç½®å†…å­˜é™åˆ¶ï¼ˆä¾‹å¦‚ 2gï¼‰å’Œ `restart: unless-stopped`
18. ç”¨æˆ·è®¤è¯æ–¹å¼
    - å»ºè®®ï¼šé»˜è®¤å•ç”¨æˆ· `local_user` ç®€åŒ–éƒ¨ç½²ï¼›æä¾›å¯é€‰ JWTï¼ˆç”± `.env` æ‰“å¼€ï¼‰
19. é‡è¯•ä¸ç†”æ–­ç­–ç•¥
    - å»ºè®®ï¼šæŒ‡æ•°é€€é¿ `sleep = base  2attempt + random(0,1)`ï¼›è¿ç»­ 5 æ¬¡åŒç±»é”™è¯¯ç†”æ–­ 15 åˆ†é’Ÿ
20. æœ€å°æµ‹è¯• fixtures
    - å»ºè®®ï¼šæä¾›æœ€å° CSV/JSON kline æ•°æ®ä¾› pytest fixtures ä½¿ç”¨
 ä¸‹ä¸€æ­¥ä¸æ“ä½œé€‰é¡¹
è¯·é€‰æ‹©ï¼š
- åœ¨æ­¤ä¼šè¯é€é¡¹ç¡®è®¤ï¼ˆæˆ‘å°†æŒ‰ä½ çš„ç¡®è®¤ç”Ÿæˆå·¥ç¨‹ï¼‰ â€” å›å¤ç¤ºä¾‹ï¼š`ç¡®è®¤ Python=3.11.7, Node=18.19.0, ä½¿ç”¨ SQLite, å…è®¸ talib`ã€‚
- æ¥å—æ–‡æ¡£ä¸­çš„é»˜è®¤å»ºè®®å¹¶ç»§ç»­ç”Ÿæˆå®Œæ•´éª¨æ¶ â€” å›å¤ `é»˜è®¤å¹¶ç»§ç»­`ã€‚
- æˆ–è¦æ±‚å¯¹æŸä¸€é¡¹å…ˆç”Ÿæˆç¤ºä¾‹å®ç°/è„šæœ¬ â€” æ¯”å¦‚ `å…ˆå®ç°æ²™ç®±` æˆ– `å…ˆå®ç° Alembic åˆ†æ”¯è¿ç§»`
æ–‡ä»¶è·¯å¾„ï¼š`docs/confirm_items.md`
ä½œè€…å·¥å…·è‡ªåŠ¨ç”Ÿæˆï¼ˆæ¥è‡ªéœ€æ±‚æ–‡æ¡£åˆ†æï¼‰ã€‚
